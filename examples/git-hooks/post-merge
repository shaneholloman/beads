#!/bin/sh
#
# beads (beads) post-merge hook
#
# This hook syncs the beads database after a git pull or merge:
# 1. Checks if any .beads/*.jsonl file was updated
# 2. Runs 'beads sync --import-only' to import changes
#
# Installation:
#   cp examples/git-hooks/post-merge .git/hooks/post-merge
#   chmod +x .git/hooks/post-merge
#
# Or use the install script:
#   examples/git-hooks/install.sh

# Check if beads is available
if ! command -v beads >/dev/null 2>&1; then
    echo "Warning: beads command not found, skipping post-merge sync" >&2
    exit 0
fi

# Check if we're in a beads workspace
if [ ! -d .beads ]; then
    # Not a beads workspace, nothing to do
    exit 0
fi

# Check if any JSONL file exists in .beads/
if ! ls .beads/*.jsonl >/dev/null 2>&1; then
    exit 0
fi

# Run beads sync --import-only to import the updated JSONL
# This is more robust than direct import as it handles all edge cases
if ! beads sync --import-only >/dev/null 2>&1; then
    echo "Warning: Failed to sync beads changes after merge" >&2
    echo "Run 'beads sync --import-only' manually" >&2
    # Don't fail the merge, just warn
fi

exit 0
