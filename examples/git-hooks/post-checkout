#!/usr/bin/env bash
#
# Beads post-checkout hook
# Automatically imports JSONL to SQLite database after checking out branches
#
# Install: cp examples/git-hooks/post-checkout .git/hooks/post-checkout && chmod +x .git/hooks/post-checkout

# Arguments provided by git:
# $1 = ref of previous HEAD
# $2 = ref of new HEAD
# $3 = flag (1 if branch checkout, 0 if file checkout)

# Only run on branch checkouts
if [[ "$3" != "1" ]]; then
    exit 0
fi

set -e

# Check if beads is installed
if ! command -v beads &> /dev/null; then
    exit 0
fi

# Check if issues.jsonl exists
if [[ ! -f .beads/issues.jsonl ]]; then
    exit 0
fi

# Import issues from JSONL
echo "Importing beads issues from JSONL..."

if beads import -i .beads/issues.jsonl 2>/dev/null; then
    echo "âœ“ Beads issues imported successfully"
else
    echo "Warning: beads import failed"
fi

exit 0
